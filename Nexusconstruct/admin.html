<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | ConstructGuard Nexus</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
</head>

<body class="bg-gray-100">
    <custom-navbar></custom-navbar>

    <!-- Admin Dashboard -->
    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-col md:flex-row gap-6">
            <!-- Sidebar -->
            <div class="w-full md:w-64 bg-white rounded-lg shadow p-4">
                <h2 class="text-xl font-bold mb-6 text-blue-800">Admin Dashboard</h2>
                <ul class="space-y-2">
                    <li><a href="#dashboard" class="admin-nav-link active">Dashboard</a></li>
                    <li><a href="#bookings" class="admin-nav-link">Bookings</a></li>
                    <li><a href="#users" class="admin-nav-link">Users</a></li>
                    <li><a href="#services" class="admin-nav-link">Services</a></li>
                    <li><a href="#equipment" class="admin-nav-link">Equipment</a></li>
                    <li><a href="#content" class="admin-nav-link">Website Content</a></li>
                    <li><a href="#settings" class="admin-nav-link">Settings</a></li>
                    <li><button onclick="logout()" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 rounded">Logout</button></li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="flex-1">
                <!-- Dashboard Section -->
                <section id="dashboard" class="admin-section">
                    <h2 class="text-2xl font-bold mb-6">Dashboard Overview</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold mb-2">Total Bookings</h3>
                            <p class="text-3xl font-bold text-blue-600" id="totalBookings">0</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold mb-2">Active Users</h3>
                            <p class="text-3xl font-bold text-green-600" id="activeUsers">0</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-lg font-semibold mb-2">Revenue</h3>
                            <p class="text-3xl font-bold text-purple-600" id="totalRevenue">KSh 0</p>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow mb-8">
                        <h3 class="text-lg font-semibold mb-4">Recent Activities</h3>
                        <div class="space-y-4" id="recentActivities">
                            <!-- Activities will be loaded here -->
                        </div>
                    </div>
                </section>

                <!-- Bookings Section -->
                <section id="bookings" class="admin-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Manage Bookings</h2>
                        <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" id="exportBookings">
                            Export to Excel
                        </button>
                    </div>
                    <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left">ID</th>
                                    <th class="px-6 py-3 text-left">Service/Equipment</th>
                                    <th class="px-6 py-3 text-left">Client</th>
                                    <th class="px-6 py-3 text-left">Dates</th>
                                    <th class="px-6 py-3 text-left">Amount</th>
                                    <th class="px-6 py-3 text-left">Status</th>
                                    <th class="px-6 py-3 text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200" id="bookingsTable">
                                <!-- Bookings will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Users Section -->
                <section id="users" class="admin-section hidden">
                    <h2 class="text-2xl font-bold mb-6">Manage Users</h2>
                    <div class="bg-white rounded-lg shadow overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left">ID</th>
                                    <th class="px-6 py-3 text-left">Name</th>
                                    <th class="px-6 py-3 text-left">Email</th>
                                    <th class="px-6 py-3 text-left">Role</th>
                                    <th class="px-6 py-3 text-left">Joined</th>
                                    <th class="px-6 py-3 text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200" id="usersTable">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Services Section -->
                <section id="services" class="admin-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Manage Services</h2>
                        <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" id="addServiceBtn">
                            Add New Service
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="servicesContainer">
                        <!-- Services will be loaded here -->
                    </div>
                </section>

                <!-- Equipment Section -->
                <section id="equipment" class="admin-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Manage Equipment</h2>
                        <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" id="addEquipmentBtn">
                            Add New Equipment
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="equipmentContainer">
                        <!-- Equipment will be loaded here -->
                    </div>
                </section>

                <!-- Content Section -->
                <section id="content" class="admin-section hidden">
                    <h2 class="text-2xl font-bold mb-6">Website Content Management</h2>
                    <div class="bg-white p-6 rounded-lg shadow mb-8">
                        <h3 class="text-lg font-semibold mb-4">Homepage Content</h3>
                        <textarea id="homepageContent" class="w-full h-64 p-4 border rounded"></textarea>
                        <button class="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Save Changes</button>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow mb-8">
                        <h3 class="text-lg font-semibold mb-4">Add New Article/Event</h3>
                        <div class="mb-4">
                            <label class="block mb-2">Title</label>
                            <input type="text" id="articleTitle" class="w-full p-2 border rounded">
                        </div>
                        <div class="mb-4">
                            <label class="block mb-2">Content</label>
                            <textarea id="articleContent" class="w-full h-64 p-4 border rounded"></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="block mb-2">Category</label>
                            <select id="articleCategory" class="w-full p-2 border rounded">
                                <option value="article">Article</option>
                                <option value="event">Event</option>
                                <option value="offer">Special Offer</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block mb-2">Featured Image</label>
                            <input type="file" id="articleImage" class="w-full p-2 border rounded">
                        </div>
                        <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Publish</button>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Add Service Modal -->
    <div id="serviceModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold" id="serviceModalTitle">Add New Service</h3>
                <button class="text-gray-500 hover:text-gray-700" id="closeServiceModal">
                    <i data-feather="x"></i>
                </button>
            </div>
            <form id="serviceForm">
                <input type="hidden" id="serviceId">
                <div class="mb-4">
                    <label class="block mb-2">Service Name</label>
                    <input type="text" id="serviceName" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-2">Description</label>
                    <textarea id="serviceDescription" class="w-full p-2 border rounded h-24" required></textarea>
                </div>
                <div class="mb-4">
                    <label class="block mb-2">Price (KSh)</label>
                    <input type="number" id="servicePrice" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-2">Category</label>
                    <input type="text" id="serviceCategory" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-2">Image</label>
                    <input type="file" id="serviceImage" class="w-full p-2 border rounded">
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                    Save Service
                </button>
            </form>
        </div>
    </div>

    <!-- Add Equipment Modal -->
    <div id="equipmentModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold" id="equipmentModalTitle">Add New Equipment</h3>
                <button class="text-gray-500 hover:text-gray-700" id="closeEquipmentModal">
                    <i data-feather="x"></i>
                </button>
            </div>
            <form id="equipmentForm">
                <input type="hidden" id="equipmentId">
                <div class="mb-4">
                    <label class="block mb-2">Equipment Name</label>
                    <input type="text" id="equipmentName" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-2">Description</label>
                    <textarea id="equipmentDescription" class="w-full p-2 border rounded h-24" required></textarea>
                </div>
                <div class="mb-4">
                    <label class="block mb-2">Price (KSh)</label>
                    <input type="number" id="equipmentPrice" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-2">Category</label>
                    <input type="text" id="equipmentCategory" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block mb-2">Availability</label>
                    <select id="equipmentAvailability" class="w-full p-2 border rounded">
                        <option value="true">Available</option>
                        <option value="false">Not Available</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block mb-2">Image</label>
                    <input type="file" id="equipmentImageFile" class="w-full p-2 border rounded">
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                    Save Equipment
                </button>
            </form>
        </div>
    </div>

    <custom-footer></custom-footer>

    <script src="components/navbar.js"></script>
    <script src="components/footer.js"></script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            feather.replace();

            // Check admin status
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/';
                return;
            }

            // Verify token and role (in a real app, this would be done via API)
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                if (payload.role !== 'admin') {
                    window.location.href = '/';
                    return;
                }
            } catch (e) {
                window.location.href = '/';
                return;
            }

            // Admin navigation
            const navLinks = document.querySelectorAll('.admin-nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('href').substring(1);

                    // Update active nav link
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');

                    // Show selected section
                    document.querySelectorAll('.admin-section').forEach(section => {
                        section.classList.add('hidden');
                    });
                    document.getElementById(sectionId).classList.remove('hidden');
                });
            });

            // Load admin data
            loadAdminData();

            // Modal functionality for services
            const serviceModal = document.getElementById('serviceModal');
            const closeServiceModal = document.getElementById('closeServiceModal');
            const addServiceBtn = document.getElementById('addServiceBtn');
            const serviceForm = document.getElementById('serviceForm');

            addServiceBtn.addEventListener('click', function() {
                document.getElementById('serviceModalTitle').textContent = 'Add New Service';
                document.getElementById('serviceId').value = '';
                serviceForm.reset();
                serviceModal.classList.remove('hidden');
            });

            closeServiceModal.addEventListener('click', function() {
                serviceModal.classList.add('hidden');
            });

            serviceForm.addEventListener('submit', function(e) {
                e.preventDefault();
                // In a real app, this would send data to the server
                alert('Service saved successfully!');
                serviceModal.classList.add('hidden');
                loadServices();
            });

            // Modal functionality for equipment
            const equipmentModal = document.getElementById('equipmentModal');
            const closeEquipmentModal = document.getElementById('closeEquipmentModal');
            const addEquipmentBtn = document.getElementById('addEquipmentBtn');
            const equipmentForm = document.getElementById('equipmentForm');

            addEquipmentBtn.addEventListener('click', function() {
                document.getElementById('equipmentModalTitle').textContent = 'Add New Equipment';
                document.getElementById('equipmentId').value = '';
                equipmentForm.reset();
                equipmentModal.classList.remove('hidden');
            });

            closeEquipmentModal.addEventListener('click', function() {
                equipmentModal.classList.add('hidden');
            });

            equipmentForm.addEventListener('submit', function(e) {
                e.preventDefault();
                // In a real app, this would send data to the server
                alert('Equipment saved successfully!');
                equipmentModal.classList.add('hidden');
                loadEquipment();
            });
        });

        function loadAdminData() {
            // In a real app, this would fetch from your API
            // For demo purposes, we'll use mock data
            document.getElementById('totalBookings').textContent = '24';
            document.getElementById('activeUsers').textContent = '156';
            document.getElementById('totalRevenue').textContent = 'KSh 1,245,000';

            // Load bookings
            const bookingsData = [{
                id: 'BK001',
                service: 'Excavator',
                client: 'John Doe',
                dates: '2023-05-01 to 2023-05-05',
                amount: 'KSh 200,000',
                status: 'Confirmed'
            }, {
                id: 'BK002',
                service: 'Building Construction',
                client: 'Jane Smith',
                dates: '2023-05-10 to 2023-06-10',
                amount: 'KSh 1,000,000',
                status: 'Pending'
            }, {
                id: 'BK003',
                service: 'Concrete Mixer',
                client: 'Mike Johnson',
                dates: '2023-05-15 to 2023-05-20',
                amount: 'KSh 45,000',
                status: 'Completed'
            }];

            const bookingsTable = document.getElementById('bookingsTable');
            bookingsTable.innerHTML = bookingsData.map(booking => `
                <tr>
                    <td class="px-6 py-4">${booking.id}</td>
                    <td class="px-6 py-4">${booking.service}</td>
                    <td class="px-6 py-4">${booking.client}</td>
                    <td class="px-6 py-4">${booking.dates}</td>
                    <td class="px-6 py-4">${booking.amount}</td>
                    <td class="px-6 py-4"><span class="px-2 py-1 rounded ${getStatusClass(booking.status)}">${booking.status}</span></td>
                    <td class="px-6 py-4">
                        <button class="text-blue-600 hover:text-blue-800 mr-2">View</button>
                        <button class="text-green-600 hover:text-green-800 mr-2">Edit</button>
                        <button class="text-red-600 hover:text-red-800">Delete</button>
                    </td>
                </tr>
            `).join('');

            function getStatusClass(status) {
                switch (status.toLowerCase()) {
                    case 'confirmed':
                        return 'bg-green-100 text-green-800';
                    case 'pending':
                        return 'bg-yellow-100 text-yellow-800';
                    case 'completed':
                        return 'bg-blue-100 text-blue-800';
                    default:
                        return 'bg-gray-100 text-gray-800';
                }
            }

            // Load users
            const usersData = [{
                id: 'US001',
                name: 'Admin User',
                email: 'admin@example.com',
                role: 'Admin',
                joined: '2023-01-15'
            }, {
                id: 'US002',
                name: 'John Contractor',
                email: 'john@example.com',
                role: 'Contractor',
                joined: '2023-02-20'
            }, {
                id: 'US003',
                name: 'Jane Client',
                email: 'jane@example.com',
                role: 'Client',
                joined: '2023-03-10'
            }];

            const usersTable = document.getElementById('usersTable');
            usersTable.innerHTML = usersData.map(user => `
                <tr>
                    <td class="px-6 py-4">${user.id}</td>
                    <td class="px-6 py-4">${user.name}</td>
                    <td class="px-6 py-4">${user.email}</td>
                    <td class="px-6 py-4">${user.role}</td>
                    <td class="px-6 py-4">${user.joined}</td>
                    <td class="px-6 py-4">
                        <button class="text-blue-600 hover:text-blue-800 mr-2">Edit</button>
                        <button class="text-red-600 hover:text-red-800">Delete</button>
                    </td>
                </tr>
            `).join('');

            // Load services
            loadServices();

            // Load equipment
            loadEquipment();
        }

        function loadServices() {
            const servicesData = [{
                id: 'SV001',
                name: 'Building Construction',
                description: 'Full construction services',
                price: '5,000',
                category: 'Construction'
            }, {
                id: 'SV002',
                name: 'Plumbing',
                description: 'All plumbing services',
                price: '3,500',
                category: 'Plumbing'
            }, {
                id: 'SV003',
                name: 'Electrical',
                description: 'Electrical installations',
                price: '4,000',
                category: 'Electrical'
            }];

            const servicesContainer = document.getElementById('servicesContainer');
            servicesContainer.innerHTML = servicesData.map(service => `
                <div class="bg-white p-4 rounded-lg shadow">
                    <div class="h-40 bg-gray-200 mb-4 rounded"></div>
                    <h3 class="font-bold text-lg">${service.name}</h3>
                    <p class="text-gray-600 mb-2">${service.description}</p>
                    <p class="text-blue-600 font-bold mb-4">KSh ${service.price}</p>
                    <div class="flex justify-between">
                        <button class="text-blue-600 hover:text-blue-800" onclick="editService('${service.id}')">Edit</button>
                        <button class="text-red-600 hover:text-red-800" onclick="deleteService('${service.id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function loadEquipment() {
            const equipmentData = [{
                id: 'EQ001',
                name: 'Excavator',
                description: '5-ton capacity',
                price: '2,500',
                category: 'Earth Moving',
                available: true
            }, {
                id: 'EQ002',
                name: 'Concrete Mixer',
                description: '3.5 cubic feet',
                price: '1,800',
                category: 'Concrete',
                available: true
            }, {
                id: 'EQ003',
                name: 'Bulldozer',
                description: 'Caterpillar D6',
                price: '3,500',
                category: 'Earth Moving',
                available: false
            }];

            const equipmentContainer = document.getElementById('equipmentContainer');
            equipmentContainer.innerHTML = equipmentData.map(item => `
                <div class="bg-white p-4 rounded-lg shadow">
                    <div class="h-40 bg-gray-200 mb-4 rounded"></div>
                    <h3 class="font-bold text-lg">${item.name}</h3>
                    <p class="text-gray-600 mb-2">${item.description}</p>
                    <p class="text-blue-600 font-bold mb-1">KSh ${item.price}</p>
                    <p class="${item.available ? 'text-green-600' : 'text-red-600'} mb-4">
                        ${item.available ? 'Available' : 'Not Available'}
                    </p>
                    <div class="flex justify-between">
                        <button class="text-blue-600 hover:text-blue-800" onclick="editEquipment('${item.id}')">Edit</button>
                        <button class="text-red-600 hover:text-red-800" onclick="deleteEquipment('${item.id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function editService(id) {
            // In a real app, this would fetch the service data
            document.getElementById('serviceModalTitle').textContent = 'Edit Service';
            document.getElementById('serviceId').value = id;
            document.getElementById('serviceName').value = 'Building Construction';
            document.getElementById('serviceDescription').value = 'Full construction services';
            document.getElementById('servicePrice').value = '5000';
            document.getElementById('serviceCategory').value = 'Construction';
            document.getElementById('serviceModal').classList.remove('hidden');
        }

        function deleteService(id) {
            if (confirm('Are you sure you want to delete this service?')) {
                alert('Service deleted successfully!');
                loadServices();
            }
        }

        function editEquipment(id) {
            // In a real app, this would fetch the equipment data
            document.getElementById('equipmentModalTitle').textContent = 'Edit Equipment';
            document.getElementById('equipmentId').value = id;
            document.getElementById('equipmentName').value = 'Excavator';
            document.getElementById('equipmentDescription').value = '5-ton capacity';
            document.getElementById('equipmentPrice').value = '2500';
            document.getElementById('equipmentCategory').value = 'Earth Moving';
            document.getElementById('equipmentAvailability').value = 'true';
            document.getElementById('equipmentModal').classList.remove('hidden');
        }

        function deleteEquipment(id) {
            if (confirm('Are you sure you want to delete this equipment?')) {
                alert('Equipment deleted successfully!');
                loadEquipment();
            }
        }

        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/';
        }
    </script>
</body>

</html>